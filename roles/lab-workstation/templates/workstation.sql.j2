use {{ db_name }};

delete from guacamole_connection where connection_name='{{ lab.workstation }}';

-- Create connection
INSERT INTO guacamole_connection (connection_name, protocol) VALUES ('{{ lab.workstation }}', 'rdp');

-- Determine the connection_id
set @connId = (SELECT connection_id FROM guacamole_connection WHERE connection_name = '{{ lab.workstation }}' AND parent_id IS NULL);

-- Add parameters to the new connection
INSERT INTO guacamole_connection_parameter VALUES (@connId, 'hostname', '{{ workstation.openstack.private_v4 }}');
INSERT INTO guacamole_connection_parameter VALUES (@connId, 'port', '3389');
INSERT INTO guacamole_connection_parameter VALUES (@connId, 'username', 'administrator');
INSERT INTO guacamole_connection_parameter VALUES (@connId, 'password', '{{ workstation_password }}');